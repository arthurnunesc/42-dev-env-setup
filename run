##!/usr/bin/env sh

USER=$(whoami) # Making sure USER variable exists

# Defining $HOME folder
echo "do you want to use /sgoinfre/Perso/$USER as your home folder? [y/N] "
read option
if [ "$option" = 'y' ] || [ "$option" = 'Y' ]; then
  HOME="/sgoinfre/Perso/$USER"
fi
bin_dir="$HOME/.local/bin"

# Making sure folders exist before installing things into them
if [ -d $HOME ]; then
    echo "$HOME directory already exists."
else
    mkdir $HOME
    chmod -R 700 $HOME
fi
if [ -d $bin_dir ]; then
    echo "$bin_dir directory already exists."
else
    mkdir -p $bin_dir
fi

# Installing brew, chezmoi, neovim and kitty
if [ -f $bin_dir/brew ]; then
    echo "brew is already installed."
else
    echo "installing brew..."
    curl -L https://github.com/Homebrew/brew/tarball/master | tar -xz --strip 1 -C $HOME/.local
fi

echo "fetching repos..."
$bin_dir/brew update -q

echo "upgrading packages..."
$bin_dir/brew upgrade -q

echo "installing packages..."
$bin_dir/brew install -q chezmoi
$bin_dir/brew install -q neovim
$bin_dir/brew install -q --cask kitty
$bin_dir/brew install -q --cask obsidian

echo "cleaning up..."
$bin_dir/brew cleanup -q

# Dotfiles
$bin_dir/chezmoi init --apply arthurnunesc
